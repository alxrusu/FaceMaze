<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<title>Gamedev Canvas Workshop</title>




    
    <style>
    	* { padding: 0; margin: 0; }
    	canvas { background: #eee; display: block; margin: 0 auto; }
    </style>


</head>
<body>
<p>Result: <output type=text id="result0" value="" readonly></output></p>
<canvas id="myCanvas" width="480" height="320"></canvas>



<script type="text/javascript">
	

	

	var canvas = document.getElementById("myCanvas");
	var ctx = canvas.getContext("2d");

	var rightPressed = false;
	var leftPressed = false;
	var upPressed = false;
	var downPressed = false;

	var x=canvas.width/2;
	var y=canvas.height/2;
	var ballRadius = 10;

	var dx=2;
	var dy=-2;


	var connection = new WebSocket('ws://localhost:8001');
	connection.onmessage = function (event){
		var tmp=event.data.split(";")
		dx=parseInt(tmp[0]);
		dy=parseInt(tmp[1]);
	};

	document.addEventListener("keydown", keyDownHandler, false);
	document.addEventListener("keyup", keyUpHandler, false);


	function getMousePos(canvas, evt) {
        var rect = canvas.getBoundingClientRect();
        return {
          x: evt.clientX - rect.left,
          y: evt.clientY - rect.top
        };
      }

	canvas.addEventListener('mousedown', function(evt) {
        var mousePos = getMousePos(canvas, evt);
        document.getElementById("result0").value=(mousePos.x+" "+mousePos.y)
        if (canvas.width/mousePos.x < canvas.height/mousePos.y)
        	upPressed=true;
        if (canvas.width/mousePos.x > canvas.height/mousePos.y)
        	downPressed=true;
        


        sendInput();
      }, false);
	canvas.addEventListener('mouseup', function(evt) {
        var mousePos = getMousePos(canvas, evt);
        if (canvas.width/mousePos.x < canvas.height/mousePos.y)
        	upPressed=false;
        if (canvas.width/mousePos.x > canvas.height/mousePos.y)
        	downPressed=false;
        sendInput();
      }, false);

	function sendInput(){
		if (rightPressed)
			connection.send("right");
		if (leftPressed)
			connection.send("left");
		if (upPressed)
			connection.send("up");
		if (downPressed)
			connection.send("down");
	}

	function keyDownHandler(e) {
	    if(e.keyCode == 39) {
	        rightPressed = true;
	    }
	    else if(e.keyCode == 37) {
	        leftPressed = true;
	    }
	    else if(e.keyCode == 38) {
	        upPressed = true;
	    }
	    else if(e.keyCode == 40) {
	        downPressed = true;
	    }
	    sendInput();
	}

	function keyUpHandler(e) {
	    if(e.keyCode == 39) {
	        rightPressed = false;
	    }
	    else if(e.keyCode == 37) {
	        leftPressed = false;
	    }
	    else if(e.keyCode == 38) {
	        upPressed = false;
	    }
	    else if(e.keyCode == 40) {
	        downPressed = false;
	    }
	    sendInput();
	}

	function drawPlayer(){
		ctx.beginPath();
		ctx.arc(x, y, ballRadius, 0, Math.PI*2);
		ctx.fillStyle = "#0077ff";
		ctx.fill();
		ctx.closePath();
	}

	function collision(){
		if (y + dy > canvas.height-ballRadius || y + dy < ballRadius) 
	 	   dy = 0;
		if (x + dx > canvas.width-ballRadius || x + dx < ballRadius) 
		    dx = 0;
	}

	function draw() {
		ctx.clearRect(0, 0, canvas.width, canvas.height);
		drawPlayer();
		
		ctx.beginPath();
		ctx.moveTo(0,0);
		ctx.lineTo(canvas.width,canvas.height);
		ctx.strokeStyle = "#ff0000";
		ctx.stroke();
		ctx.closePath();

		ctx.beginPath();
		ctx.moveTo(0,canvas.height);
		ctx.lineTo(canvas.width,0);
		ctx.strokeStyle = "#ff0000";
		ctx.stroke();
		ctx.closePath();

		collision();

		x+=dx;
		y+=dy;

		

	}
	setInterval(draw, 10);
		



	</script>



</body>
</html>